{% extends "layout.html" %}
{% block title %}Admin · Indian Food App{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">Admin Dashboard</h2>
  <div class="d-flex gap-2">
    <a href="{{ url_for('menu') }}" class="btn btn-outline-secondary btn-sm">View Menu</a>
    <a href="{{ url_for('admin_sections') }}" class="btn btn-outline-primary btn-sm">Sections</a>
    <a href="{{ url_for('logout') }}" class="btn btn-outline-danger btn-sm">Logout</a>
  </div>
</div>

<!-- Stats -->
<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <div class="text-muted small">Total Items</div>
        <div class="h4 mb-0">{{ items|length }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <div class="text-muted small">Total Orders</div>
        <div class="h4 mb-0">{{ orders|length }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <div class="text-muted small">Pending</div>
        <div class="h4 mb-0">
          {{ orders|selectattr('status','equalto','pending')|list|length }}
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <div class="text-muted small">Delivered (24h)</div>
        <div class="h4 mb-0">
          {% set delivered = orders|selectattr('status','equalto','delivered')|list %}
          {{ delivered|length }}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions -->
<div class="card shadow-sm mb-4">
  <div class="card-body d-flex flex-wrap gap-2">
    <a href="{{ url_for('admin') }}" class="btn btn-outline-secondary btn-sm">Refresh</a>
    <a href="{{ url_for('admin_sections') }}" class="btn btn-outline-primary btn-sm">Manage Sections</a>
    <a href="{{ url_for('admin_items') if 'admin_items' in globals() else '#' }}" class="btn btn-outline-primary btn-sm">Manage Items</a>
    <a href="{{ url_for('admin_orders') if 'admin_orders' in globals() else '#' }}" class="btn btn-outline-primary btn-sm">Manage Orders</a>
  </div>
</div>

<div class="row g-4">
  <!-- Recent Orders -->
  <div class="col-lg-7">
    <div class="card shadow-sm h-100">
      <div class="card-header d-flex justify-content-between align-items-center">
        <strong>Recent Orders</strong>
        <a href="{{ url_for('admin_orders') if 'admin_orders' in globals() else '#' }}" class="btn btn-sm btn-outline-secondary">All</a>
      </div>
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Customer</th>
              <th>Total</th>
              <th>Status</th>
              <th>Placed</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for o in orders[:10] %}
            <tr>
              <td>{{ o.id }}</td>
              <td>{{ o.customer_name or o.user_name or '—' }}</td>
              <td>{{ (o.total or 0)|vnd }}</td>
              <td>
                <span class="badge text-bg-{% if o.status=='pending' %}warning{% elif o.status=='confirmed' %}info{% elif o.status=='preparing' %}secondary{% elif o.status=='out_for_delivery' %}primary{% elif o.status=='delivered' %}success{% else %}light{% endif %}">
                  {{ o.status|replace('_',' ')|title }}
                </span>
              </td>
              <td class="text-nowrap">{{ o.created_at or o.placed_at or '' }}</td>
              <td class="text-end">
                <a class="btn btn-sm btn-outline-primary" href="{{ url_for('order_detail', order_id=o.id) }}">View</a>
              </td>
            </tr>
            {% else %}
            <tr><td colspan="6" class="text-center text-muted">No orders yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Items -->
  <div class="col-lg-5">
    <div class="card shadow-sm h-100">
      <div class="card-header d-flex justify-content-between align-items-center">
        <strong>Items</strong>
        <a href="{{ url_for('admin_item_new') if 'admin_item_new' in globals() else '#' }}" class="btn btn-sm btn-primary">Add Item</a>
      </div>
      <div class="table-responsive" style="max-height:480px;">
        <table class="table table-sm table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>Price</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for it in items %}
            <tr>
              <td>{{ it.id }}</td>
              <td class="text-truncate" style="max-width:180px">{{ it.name }}</td>
              <td>{{ it.price|vnd }}</td>
              <td class="text-end">
                <a href="{{ url_for('admin_item_edit', item_id=it.id) if 'admin_item_edit' in globals() else '#' }}" class="btn btn-sm btn-outline-secondary">Edit</a>
                <a href="{{ url_for('admin_item_delete', item_id=it.id) if 'admin_item_delete' in globals() else '#' }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete item #{{ it.id }}?')">Delete</a>
              </td>
            </tr>
            {% else %}
            <tr><td colspan="4" class="text-center text-muted">No items found.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
